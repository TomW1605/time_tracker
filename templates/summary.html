<!DOCTYPE html>
<html>
<head>
    <title>Summary</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <style>
        h3, p {
            display: inline-block;
            margin: 0 5px 5px 0;
        }
    </style>
    <script>
        function loadSessions() {
            fetch("{{ url_for('api_get_sessions') }}")
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('sessionsTableBody');
                data.forEach(session => {
                    const row = document.createElement('tr');

                    const idCell = document.createElement('td');
                    idCell.textContent = session.id;
                    row.appendChild(idCell);

                    const typeCell = document.createElement('td');
                    typeCell.textContent = session.session_type;
                    row.appendChild(typeCell);

                    const dateCell = document.createElement('td');
                    dateCell.textContent = session.date;
                    row.appendChild(dateCell);

                    const hoursWorkedCell = document.createElement('td');
                    hoursWorkedCell.textContent = session.hours_worked;
                    row.appendChild(hoursWorkedCell);

                    const clockInCell = document.createElement('td');
                    clockInCell.textContent = session.clock_in_time;
                    row.appendChild(clockInCell);

                    const clockOutCell = document.createElement('td');
                    clockOutCell.textContent = session.clock_out_time;
                    row.appendChild(clockOutCell);

                    const editCell = document.createElement('td');
                    const editLink = document.createElement('a');
                    editLink.href = "{{ url_for('edit', id=0) }}" + session.id;
                    editLink.textContent = 'Edit';
                    editCell.appendChild(editLink);
                    row.appendChild(editCell);

                    const deleteCell = document.createElement('td');
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.onclick = function() {
                        deleteSession(session.id);
                    };
                    deleteCell.appendChild(deleteButton);
                    row.appendChild(deleteCell);

                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Error:', error));
        }

        function loadHours() {
            fetch("{{ url_for('api_get_hours') }}")
            .then(response => response.json())
            .then(data => {
                const hours_el = document.getElementById('hours');
                console.log(data);

                const today_heading = document.createElement('h3');
                today_heading.textContent = "Hours worked today:";
                hours_el.appendChild(today_heading);

                const today_hours = document.createElement('p');
                today_hours.textContent = data.hours_today;
                hours_el.appendChild(today_hours);

                hours_el.appendChild(document.createElement('br'));

                const week_heading = document.createElement('h3');
                week_heading.textContent = "Hours worked this week:";
                hours_el.appendChild(week_heading);

                const week_hours = document.createElement('p');
                week_hours.textContent = data.hours_this_week;
                hours_el.appendChild(week_hours);
            })
            .catch(error => console.error('Error:', error));
        }

        function deleteSession(id) {
            if (confirm('Are you sure you want to delete this session?')) {
                fetch("{{ url_for('api_delete_session', id=0) }}" + id, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    location.reload();
                })
                .catch(error => console.error('Error:', error));
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadSessions();
            loadHours();
        });
    </script>
</head>
<body>
    <h1>Summary</h1>
    <div id="hours"></div>
    <p><a href="{{ url_for('index') }}">Home</a></p>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Type</th>
                <th>Date</th>
                <th>Hours Worked</th>
                <th>Clock In</th>
                <th>Clock Out</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody id="sessionsTableBody">
            <!-- Data will be loaded here by JavaScript -->
        </tbody>
    </table>
</body>
</html>
